test_name: Test comments lifecycle

stages:
  - name: Post an anonymous comment
    request:
      url: http://localhost/comments/new/article/1
      json:
        text: this is a test comment
      method: POST
      headers:
        content-type: application/json
    response:
      status_code: 200
      headers:
        content-type: application/json
      body:
        article_id: /article/1
        comments:
          - id: 14
            author: Anonymous Coward
            content: this is a test comment
            posted: !anything
          - id: 1
            author: testuser
            content: that's super cool
            posted: !anything
  - name: Make sure an authenticated comment can be posted
    request:
      url: http://localhost/comments/new/article/1
      auth:
        - testuser
        - testuser
      json:
        text: this is a test authed comment
      method: POST
      headers:
        content-type: application/json
    response:
      status_code: 200
      headers:
        content-type: application/json
      body:
        article_id: /article/1
        comments:
          - id: 15
            author: testuser
            content: this is a test authed comment
            posted: !anything
          - id: 2
            author: Anonymous Coward
            content: this is a test comment
            posted: !anything
          - id: 1
            author: testuser
            content: that's super cool
            posted: !anything
  - name: Make sure comments are retrieved in order
    request:
      url: http://localhost/comments/3/article/1
      method: GET
      headers:
        content-type: application/json
    response:
      status_code: 200
      headers:
        content-type: application/json
      body:
        count: 3
        comments:
          - author: testuser
            content: this is a test authed comment
          - author: Anonymous Coward
            content: this is a test comment
          - author: testuser
            content: that's super cool